Description: Set compiler flags

Respect CFLAGS,CXXFLAGS,LDFLAGS (security hardening etc.)
Be verbose
Disable non-policy-compliant instruction set assumptions (slows the
OpenCL compiler by ~few%, no effect on OpenCL execution speed)

Author: Simon Richter <sjr@debian.org>,Rebecca Palmer <rebecca_palmer@zoho.com>
--- beignet.orig/CMakeLists.txt
+++ beignet/CMakeLists.txt
@@ -41,7 +41,6 @@ INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINA
 
 INCLUDE (FindPkgConfig)
 
-SET(CMAKE_VERBOSE_MAKEFILE "false")
 set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_SOURCE_DIR}/CMake/")
 INCLUDE (GNUInstallDirs OPTIONAL)
 # support old CMake without GNUInstallDirs
@@ -83,9 +82,9 @@ ADD_DEFINITIONS(-DGEN7_SAMPLER_CLAMP_BOR
 
 # compiler flag setting
 if (COMPILER STREQUAL "GCC")
-  set (CMAKE_C_CXX_FLAGS "${CMAKE_C_CXX_FLAGS} -funroll-loops -fstrict-aliasing -msse2 -msse3 -mssse3 -msse4.1 -fPIC -Wall -mfpmath=sse -Wcast-align -Wl,-E")
+  set (CMAKE_C_CXX_FLAGS "${CMAKE_C_CXX_FLAGS} -funroll-loops -fstrict-aliasing -fPIC -Wall -Wcast-align -Wl,-E")
 elseif (COMPILER STREQUAL "CLANG")
-  set (CMAKE_C_CXX_FLAGS "${CMAKE_C_CXX_FLAGS} -funroll-loops -fstrict-aliasing -msse2 -msse3 -mssse3 -msse4.1 -fPIC -Wall")
+  set (CMAKE_C_CXX_FLAGS "${CMAKE_C_CXX_FLAGS} -funroll-loops -fstrict-aliasing -fPIC -Wall")
 elseif (COMPILER STREQUAL "ICC")
   set (CMAKE_C_CXX_FLAGS "${CMAKE_C_CXX_FLAGS}  -wd2928 -Wall -fPIC -fstrict-aliasing -fp-model fast -msse4.1 -Wl,-E")
 endif ()
--- beignet.orig/backend/src/sys/platform.hpp
+++ beignet/backend/src/sys/platform.hpp
@@ -41,15 +41,6 @@
 #define __X86__
 #endif
 
-/* We require SSE ... */
-#ifndef __SSE__
-#define __SSE__
-#endif
-
-/* ... and SSE2 */
-#ifndef __SSE2__
-#define __SSE2__
-#endif
 
 #if defined(_INCLUDED_IMM)
 // #define __AVX__
--- beignet.orig/utests/CMakeLists.txt
+++ beignet/utests/CMakeLists.txt
@@ -340,6 +340,12 @@ add_custom_target(utest_generator
     WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
     )
 
+#the test suite doesn't go into the final package, and compiler_{degrees,radians,function_argument2} use equality comparison of floats
+if (COMPILER STREQUAL "GCC")
+  SET(CMAKE_CXX_FLAGS "-msse -mfpmath=sse ${CMAKE_CXX_FLAGS}")
+  SET(CMAKE_C_FLAGS "-msse -mfpmath=sse ${CMAKE_C_FLAGS}")
+endif ()
+
 if (EGL_FOUND AND MESA_SOURCE_FOUND)
   SET(utests_sources ${utests_sources} compiler_fill_gl_image.cpp)
   SET(CMAKE_CXX_FLAGS "-DHAS_EGL ${CMAKE_CXX_FLAGS} ${DEF_OCL_PCH_PCM_PATH}")
